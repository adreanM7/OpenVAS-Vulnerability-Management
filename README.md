# Vulnerablility Management Using OpenVAS & Azure

![OpenVAS_Vulnerability Managment Lab](https://github.com/user-attachments/assets/7dc720bd-5a2a-4f48-a7f6-875ad5b7574e)


## Introduction

In this project, I created a Full Techincal vulnerablility Management in the cloud. First creating a Virtual Machine in Microsoft Azure. I installed Insecure software on the VM to see how many vulnerablility it would create. once downloaded I Then create a vulnerablility Management server using OpenVAS, I w 

- SecurityEvent (Windows Event Logs)
- Syslog (Linux Event Logs)
- SecurityAlert (Log Analytics Alerts Triggered)
- SecurityIncident (Incidents created by Sentinel)
- AzureNetworkAnalytics_CL (Malicious Flows allowed into our honeynet)

## Create our Free Azure Account
<img width="720" alt="Screen Shot 2024-07-18 at 3 41 46 PM" src="https://github.com/user-attachments/assets/ff2a398e-2165-4b47-86a8-237f796dbf30">

1. Sign up for Azure Account
2. Login to Azure Portal

## Prepare Vulnerability Management Scanner
<img width="207" alt="Screen Shot 2024-07-17 at 10 39 31 AM" src="https://github.com/user-attachments/assets/0587aa3e-36f3-4d56-a162-61bc4799d219">


1. Go to Azure Portal 
2. Navigate to the Marketplace and search for “OpenVAS secured and supported by HOSSTED”
3. Choose the “Start with a pre-set configuration” option and select the weakest one
4. Cleck “Continue to Create VM”
5. Configure the VM
   - Resource Group: Vulnerability-Management
   - VM Name: OpenVAS (Take note of the region and Vnet–consider East US 2)
   - Authentication: Username → Created Username / Created Password
   - Monitoring: Disable Boot Diagnostic (don’t need it)
6. Click Create → Create
7. Once the VM has been created, SSH into it With PowerShell (windows) or Terminal (MacOS) using the credentials you created earlier
8. Don’t touch anything, you’ll notice the “Your openvas is deploying, please wait”
   - Wait until it says “hossted stage done”  
<img width="554" alt="Screen Shot 2024-07-19 at 9 21 59 PM" src="https://github.com/user-attachments/assets/f1ad72fc-aea7-4d90-bfa0-3c9014f1f959">

   - It should show the web app URL and default username and password at this point, attempt to go to the URL in the browser and login with the username and password. If it doesn’t work, try admin/admin:
<img width="586" alt="Screen Shot 2024-07-19 at 9 22 21 PM" src="https://github.com/user-attachments/assets/30c1f9c3-12c8-41bd-b05b-af0355c319a4">


   - For the "AFTER" metrics, Network Security Groups were hardened by blocking ALL traffic with the exception of my admin workstation, and all other resources were protected by their built-in firewalls as well as Private Endpoint

## Create Client Virtual Machine and Make it Vulnerable

9. https://portal.azure.com/
10. Search for Virtual Machines and create a new Virtual Machine
   - Resource Group: Vulnerability-Management
   - VM Name: Win10-Vulnerable
   - Region: Same as the OpenVAS VM (East US 2)
   - Virtual Network: Same as OpenVAS (this is important)
   - Image: Windows 10 Pro
Size: Any size with 2 vCPUs
Username: azureuser / Cyberlab123!
Networking: Same Vnet as OpenVAS
Create the VM
11. After the VM has been created, ensure you can RDP into it with the credentials you created.
12. After logging in, make the VM vulnerable:
   - Disable the Windows Firewall
   - Old Software
     - Install an Old Version of FireFox: Firefox Setup 97.0b5
     - Install an Old Version of VLC Player: vlc-1.1.7-win32
     - Install an Old Version of Adobe Reader: 10.0_AdbeRdr1000_en_US_1_
     - Restart the VM
13. Leave the VM for now


## Configure and OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM

14. Login to OpenVAS → Assets → Hosts → New Host
    - Add the Client VM PRIVATE IP Address
15. Create a New Target from the Host, name it “Azure Vulnerable VMs”.
    - Take note of the credentials. We will add SMB credentials later.
16. Create a new Task
    - Name & Comment: “Scan - Azure Vulnerable VMs”
    - Scan Targets → “Azure Vulnerable VMs”
    - Save the Task
17. “Start” the “Scan - Azure Vulnerable VMs” Task
    - Take note of the Status:

18. Once the scan is finished, click the date under “Last Report” to see the results


   - Take note of Tabs, specifically the “Results” tab. Even though we installed a super old version of Firefox, note that it does not show up here.
   - Note that this is because we aren’t running a credentialed scan so the scanner could not discover it. We will configure credential scans next



## Make Configurations for Credentialed Scans (Within VM)

19. Disable Windows Firewall
20. Disable User Account Control
21. Enable Remote Registry
22. Set Registry Key
  - Launch Registry Editor (regedit.exe) in “Run as administrator” mode and grant Admin Approval, if requested
  - Navigate to HKEY_LOCAL_MACHINE hive
  - Open SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System key
  - Create a new DWORD (32-bit) value with the following properties:  Name: LocalAccountTokenFilterPolicy  Value: 1
  - Close Registry Editor  
  - Restart the VM


## Make Configurations for Credentialed Scans (OpenVAS)

23. Go to Configuration → Credentials → New Credential
  - Name / Comment → “Azure VM Credentials”
  - Allow Insecure Use: Yes
  - Username: azureuser
  - Password: Cyberlab123!
  - Save
24. Go to Configuration → Targets → CLONE the Target we made before
  - NEW Name / Comment: “Azure Vulnerable VMs - Credentialed Scan”
  - Ensure the Private IP is still accurate
  - Credentials → SMB → Select the Credentials we just made: Azure VM Credentials
  - Save




## Execute Credentialed Scan against our Vulnerable Windows VM
25. Within Greenbone / OpenVAS, go to Scans → Tasks
26. CLONE the “Scan - Azure Vulnerable VMs” Task, then Edit it:
  - Name / Comment → “Scan - Azure Vulnerable VMs - Credentialed”
  - Targets: Azure Vulnerable VMs - Credentialed Scan
  - Save
27. Click the Play button to launch the new Credentialed Scan, wait for it to finish
  - It will take longer than the last one. Wait for it to finish
28. After the credentialed scan finishes, you can immediately see the difference in findings:

  - Check SMB Login under “Results”
29. Further inspect the individual vulnerabilities and see all the Criticals from the out-of-date FireFox
  - Remove the Filter (upper right)


## Remediate Vulnerabilities
30. Log back into your Win10-Vulnerable VM
31. Uninstall Adobe Reader, VLC Player, and Firefox
32. Restart the VM
## Verify Remediations
33. Re-initiate the “Scan - Azure Vulnerable VMs - Credentialed” scan and observe the results.

